<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <link href="img/spf_favicon.png" rel="icon">
  <title>Portal de Módulos</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body{font-family:Verdana, Geneva, Tahoma, sans-serif;background:#eee;margin:0}
    header{text-align:center;background:#254d79;color:#fff;padding:28px 0}
    h1{margin:0;font-size:2em;letter-spacing:2px}
    .modules{display:flex;justify-content:center;flex-wrap:wrap;padding:36px;gap:24px}
    .module-btn{background:#fff;border:1px solid #bbb;border-radius:12px;min-width:180px;min-height:100px;
      box-shadow:0 4px 18px #0e427a15;cursor:pointer;display:flex;align-items:center;flex-direction:column;padding:14px 18px;transition:.18s}
    .module-btn:hover{transform:translateY(-4px);box-shadow:0 6px 28px #0e224a33}
    .module-tower{width:46px;height:46px;margin-bottom:8px;object-fit:contain}
    .module-label{font-weight:700;color:#133356}
    .back-btn{position:fixed;top:14px;left:10px;background:#dde3f4;color:#223c60;border:none;border-radius:6px;padding:6px 12px;cursor:pointer;display:none;z-index:10}
    .logout-btn{position:fixed;top:14px;right:10px;background:#e44;color:#fff;border:none;border-radius:6px;padding:6px 12px;cursor:pointer;z-index:10}
    main{max-width:1000px;margin:30px auto;padding:0 16px}
    .content{display:none;background:#fff;padding:26px;border-radius:12px;box-shadow:0 2px 12px #2a3b6217}
    @media(max-width:720px){.modules{flex-direction:column;align-items:center;padding:16px}}
  </style>
</head>
<body>
  <header>
    <h1>Portal de Módulos</h1>
    <div style="opacity:.9;margin-top:6px">Selecciona un módulo</div>
  </header>

  <button class="back-btn" onclick="showHome()">← Volver a módulos</button>
  <button class="logout-btn" onclick="logout()">Cerrar sesión</button>

  <main>
    <section id="modules" class="modules">
      <button class="module-btn" onclick="showModule('despacho')">
        <img class="module-tower" src="img/spf_favicon" alt="Despacho">
        <span class="module-label">Despacho</span>
      </button>

      <button class="module-btn" onclick="showModule('gde')">
        <img class="module-tower" src="img/spf_favicon" alt="Gde">
        <span class="module-label">Gde</span>
      </button>

      <button class="module-btn" onclick="showModule('lpu')">
        <img class="module-tower" src="img/spf_favicon" alt="Lpu">
        <span class="module-label">Lpu</span>
      </button>

      <button class="module-btn" onclick="showModule('telefonos-spf')">
        <img class="module-tower" src="img/spf_favicon" alt="Teléfonos SPF">
        <span class="module-label">Teléfonos SPF</span>
      </button>
    </section>

    <!-- Contenidos de módulos locales -->
    <section id="despacho-content" class="content">
      <h2>Módulo Despacho</h2>
      <p>Contenido de Despacho ...</p>
    </section>

    <section id="gde-content" class="content">
      <h2>Módulo Gde</h2>
      <p>Contenido de Gde ...</p>
    </section>

    <section id="lpu-content" class="content">
      <h2>Módulo Lpu</h2>
      <p>Contenido de Lpu ...</p>
    </section>

    <!-- Sección destino para telefono.html -->
    <section id="telefonos-spf-content" class="content"></section>

  </main>

  <script>
    // Comprobación de sesión simple; redirige a login si no hay usuario
    if (!localStorage.getItem('login_usuario')) {
      window.location.href = 'login.html';
    }

    function logout(){
      localStorage.removeItem('login_usuario');
      window.location.href='login.html';
    }

    // Lista de módulos (sin "telefono")
    const moduleIds = ['despacho','gde','lpu','telefonos-spf'];

    function hideAllContents(){
      document.querySelectorAll('.content').forEach(c => c.style.display='none');
    }

    function showModule(module){
      // Oculta la lista de módulos
      const modules = document.getElementById('modules');
      if (modules) modules.style.display = 'none';

      // Oculta todo el contenido
      hideAllContents();

      // Carga externa solo para telefonos-spf
      if (module === 'telefonos-spf') {
        loadExternalPage('telefono.html', 'telefonos-spf-content');
      } else {
        // Mostrar sección local (despacho, gde, lpu)
        const sec = document.getElementById(module + '-content');
        if (sec) sec.style.display = 'block';
      }

      // Mostrar botón volver
      const backBtn = document.querySelector('.back-btn');
      if (backBtn) backBtn.style.display = 'block';

      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function showHome(){
      // Mostrar módulos
      const modules = document.getElementById('modules');
      if (modules) modules.style.display = 'flex';

      // Ocultar todo contenido (incluye telefonos-spf-content)
      hideAllContents();

      // Ocultar boton volver
      const backBtn = document.querySelector('.back-btn');
      if (backBtn) backBtn.style.display = 'none';

      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // Carga una página externa (HTML) dentro de una sección destino
    function loadExternalPage(path, targetId){
      fetch(path)
        .then(resp => {
          if (!resp.ok) throw new Error('No se pudo cargar ' + path);
          return resp.text();
        })
        .then(html => {
          let target = document.getElementById(targetId);
          if (!target) {
            // crear la sección si no existe (mantiene la clase content para showHome)
            target = document.createElement('section');
            target.className = 'content';
            target.id = targetId;
            document.querySelector('main').appendChild(target);
          }
          target.innerHTML = html;
          target.style.display = 'block';
        })
        .catch(err => {
          console.error(err);
          let target = document.getElementById(targetId);
          if (!target) {
            target = document.createElement('section');
            target.className = 'content';
            target.id = targetId;
            document.querySelector('main').appendChild(target);
          }
          target.innerHTML = '<p style="color:#c0392b">Error al cargar el contenido.</p>';
          target.style.display = 'block';
        });
    }

    // Inicialización: ocultar contenidos y back btn
    hideAllContents();
    const backBtnInit = document.querySelector('.back-btn');
    if (backBtnInit) backBtnInit.style.display = 'none';
  </script>
</body>
</html>